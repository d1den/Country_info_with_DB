# Country_info_with_DB
## WinForms приложение для работы с БД MS SQL, хранящей данные о странах.  
**Формулировка задачи:**  
Нужно сделать приложение, в котором пользователь по введенной стране будет получать по ней 
информацию (Название, Код страны, Столица, Площадь, Население, Регион).  
Требования к заданию:
1. При запуске приложения должно быть 2 функциональности на выбор пользователя: Ввод
названия страны; вывод всех стран с БД. После ввода страны должно выдать информацию о
стране (Название, Код страны, Столица, Площадь, Население, Регион) либо если страна не
найдена выдать об этом сообщение.
2. Далее выдать предложение пользователю сохранить информацию в базу (MS SQL). Если
пользователь отказывается - не сохранять.
    1. В БД должно быть 3 таблицы: Регионы(Id - идентификатор, Название - строка),
Города(Id - идентификатор, Название - строка), Страны – (Id - идентификатор, Название
– строка, Код страны – строка, Столица – идентификатор с таблицы Города, площадь –
дробное число, Население – целое число, Регион – идентификатор с таблицы Регионы)
    2. Алгоритм добавления, следующий:
        1. проверяем наличие Столицы в таблице Города, если найдена, то берем её
идентификатор, если нет, то добавляем;
        2. проверяем наличие Региона в таблице Регионов, если найден, то берем его
идентификатор, если нет, то добавляем;
        3. Проверяем наличие Страны в таблице стран по коду страны, если
страна не найдена – добавляем с идентификаторами, полученными выше,
если найдена обновляем значения.
3. При выборе вывода всех стран БД должен вывестись список всех стран в БД со следующими
полями: Название, Код страны, Столица, Площадь, Население, Регион. Прошу обратить
внимание, что Столицу и Регион тут нужно выводить название.

**Репозиторий включает в себя следующие папки:**  
1. CountiesDB - папка проекта;  
2. images - папка со скриншотами;  
3. InfoAboutCountry.bak - бэкап базы данных для MS SQL Server.  

Программа типа WinForms разарботана на языке C# и .Net Framework 4.7.2. База данных создана на MS SQL Express 2014 года.
**Структурная схема созданной БД:**  
![structure](https://github.com/d1den/Country_info_with_DB/blob/master/images/DB_structure.png?raw=true "structure")  
**Первоначальное содержание таблиц:**  
![test1_1](https://github.com/d1den/Country_info_with_DB/blob/master/images/test1_1.JPG?raw=true "test1_1")  
![test1_2](https://github.com/d1den/Country_info_with_DB/blob/master/images/test1_2.JPG?raw=true "test1_2")  
![test1_3](https://github.com/d1den/Country_info_with_DB/blob/master/images/test1_3.JPG?raw=true "test1_3")  

**Возможности программы:**  
1. Прежде всего в программе можно открыть раздел "Справка" и ознакомиться кратко с работой программы  
![test0](https://github.com/d1den/Country_info_with_DB/blob/master/images/test0.JPG?raw=true "test0")  
2. Далее в разделе "Подключение к БД" можно изменить настройки подключения (имя сервера, название БД и таблиц), после же применения
настроек выйдет сообщение о состоянии подключения  
![test0_1](https://github.com/d1den/Country_info_with_DB/blob/master/images/test0_1.JPG?raw=true "test0_1")  
![test0_2](https://github.com/d1den/Country_info_with_DB/blob/master/images/test0_2.JPG?raw=true "test0_2")  
3. Чтобы просмотреть данные по странам необходимо перейти в раздел "Просмтор БД":  
    + Там можно выбрать (выбрано по умолчанию) вывод всех странн из БД  
    ![test2](https://github.com/d1den/Country_info_with_DB/blob/master/images/test2.JPG?raw=true "test2")  
    + Вывод конкретной страны по её названию  
    ![test3](https://github.com/d1den/Country_info_with_DB/blob/master/images/test3.JPG?raw=true "test3")  
4. Если при выборе всех стран в БД не будет ни одной страны, то выйдет сообщение об этом с предложением добавить новую страну.
При нажатии на клавишу "Да" будет совершён переход в раздел "Добавить запись". Если выполнялся вывод конкретной страны по названию,
и её не было обнаружено в БД, то после соглашения добавить её в разделе "Добавить запись" автоматически заполнится поле с названием страны  
![test4](https://github.com/d1den/Country_info_with_DB/blob/master/images/test4.JPG?raw=true "test4")  
5. В разделе "Добавить запись" для добавления новой записи в БД необходимо заполнить поля и нажать клавишу "Добавить". 
В поле площадь вводится вещественное число, а в поле население - целое. Если при заполнении таблицы произойдут ошибки, то выйдет сообщение об этом. 
После добавления записи выйдет окно об успешном добавлении  
![test5](https://github.com/d1den/Country_info_with_DB/blob/master/images/test5.JPG?raw=true "test5")  
![test6](https://github.com/d1den/Country_info_with_DB/blob/master/images/test6.JPG?raw=true "test6")  
Проверим в самом приложении и в Managment Studio, что страна действительно добавилась:  
![test7](https://github.com/d1den/Country_info_with_DB/blob/master/images/test7.JPG?raw=true "test7")  
![test8](https://github.com/d1den/Country_info_with_DB/blob/master/images/test8.JPG?raw=true "test8")  
![test9](https://github.com/d1den/Country_info_with_DB/blob/master/images/test9.JPG?raw=true "test9")  
6. Также приложение корректно масштабируется  
![test10](https://github.com/d1den/Country_info_with_DB/blob/master/images/test10.JPG?raw=true "test10")  

**Реализация приложения:**  
1. Вся работа с БД (запросы и проверка соединения) выполняются в отедльном статическом классе - WorkWithDB;
2. Работа с GUI идёт в классе Forms1;  
3. Реализована обработка известных ошибок.  
  
## Некоторые доработки и исправления  
**Функциональные изменния:**  
1. Добавлен раздел получения стран с Api https://restcountries.eu/rest/v2/ . Где доступно получение всех стран с Api;  
![test11](https://github.com/d1den/Country_info_with_DB/blob/master/images/test11.JPG?raw=true "test11")  
2. Получение 1 страны с Api. Если страна нашлась, то будет предложено добавить её в БД. Далее будет выведена информация о стране;  
![test12](https://github.com/d1den/Country_info_with_DB/blob/master/images/test12.JPG?raw=true "test12")  
![test13](https://github.com/d1den/Country_info_with_DB/blob/master/images/test13.JPG?raw=true "test13")  
3. Если не было получено ни одной страны, то выйдет сообщение о том, с чем может быть связана данная проблема. 
Далее будет предложено добавить эту страну в БД вручную.
Если пользователь согласится, то откроется раздел добавления страны и туда перенесётся её название.  
![test14](https://github.com/d1den/Country_info_with_DB/blob/master/images/test14.JPG?raw=true "test14")  
![test15](https://github.com/d1den/Country_info_with_DB/blob/master/images/test15.JPG?raw=true "test15")  
4. Был изменён раздел настроек подключения к БД:  
    + Название сервера вводится корректно;  
    + Убран ввод названий таблиц (так как это принято излишним);  
    + Теперь выбирается тип аутентификации (Windows или Sql Server). 
    При выборе Windows аутентификации поля ввода имени пользователя и пароля будут недоступны и очищены. 
    В другом случае поля ввода становятся доступными.  
![test16](https://github.com/d1den/Country_info_with_DB/blob/master/images/test16.JPG?raw=true "test16")  
![test17](https://github.com/d1den/Country_info_with_DB/blob/master/images/test17.JPG?raw=true "test17")  
  
**Изменения в реализации:**  
1. Создан класс Country, описывабщий необходимые для получения с Api данные. Хранится в папке Model;  
2. Создана папка Repositories, где находятся 2 класса: WorkWithDb и WorkWithApi, в которых описано всё для работы с Api и БД;  
3. Переписан код, во всех классах повторяющиеся фрагменты кода вынесены в отдельные методы. 
Каждый класс и каждый метод выполняет свою задачу;  
4. Исправлено комментирование кода (убраны избыточные комментарии и оставлены только важные);  
5. Проверены, исправлены и обработанны некоторые ошибки;  
6. Изменено содержание ДБ, так как теперь она содержит данные на Английском языке (и обновлён её бэкап).
